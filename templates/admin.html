<!-- Hello Admin -->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings</title>
    <link rel="stylesheet" href='static\css\main.css'>
    <link rel="icon" type="image/png" sizes="16x16" href="static\images\favicon.png">
</head>
{% include "header.html" %}

<body class="form1">
    <form class="" method="POST">
        <div class="text-container">
            <div class="perm-block" style="margin: 5%;">
                <!-- TODO: Hookup changes, should be easy -->
                <h1>Admin Property Changes:</h1>
                <label for="viewer">Viewers have add permissions</label>
                <input type="checkbox" id="viewer" name="viewer" value=true {% if Admin.visitor_can_add %}checked{%
                    endif %}><br>

                <label for="editor">Editors have remove permissions</label>
                <input type="checkbox" id="editor" name="editor" value=true {% if Admin.editor_can_remove %}checked{%
                    endif %}><br>
            </div>
            <div class="address-block">
                <label for="address">Default Address:</label>
                <input class="address" id="address" type="text" name="address" value="{{ Admin.default_address }}">
            </div>
            <div class="header-block">
                <label for="header_name">Webpage Title:</label>
                <input class="header_name" id="header_name" type="text" name="header_name"
                    value="{{ Admin.header_name }}">
            </div>
            <p id="reminder">You have unsaved changes. Please hit the save button.</p>
            <input type="submit" value="Save Changes">
            <br>
            <br>
        </div>
    </form>
    <br>
    <div class="text-container">
        <div style="margin: 5%;">
            <h1 style="text-align: center;">Database Changes:</h1>
            <div class="database-block">
                <div class="separator">
                    <button class="button" onclick="location.href='/admin?q=export';">Export Database</button>
                </div>
                <div class="separator">
                    <button class="button" onclick="openPopup('clear')">Clear Cache</button><br>
                </div>
                <div class="separator">
                    <button class="button" onclick="openPopup('import')">Import Database</button><br>
                </div>
                <div class="separator">
                    <button class="button" onclick="openPopup('delete')">Delete Database</button>
                </div>
            </div>
        </div>
    </div>
    <div class="popup-overlay" id="popup-overlay"></div>

    <div class="popup" id="popup">
        <div class="popup-content">
            <span class="close-btn" onclick="closePopup()">&times;</span>
            <h2>Preform Action?</h2>
            <p></p>
            <form style="display: none;" action="/admin?q=import" method="POST" enctype="multipart/form-data">
                <input type="file" name="file" />
                <br>
                <input type="submit" />
                <br>
            </form>
            <button class="button" onclick="">Confirm</button>
        </div>
    </div>

    <script>
        function openPopup(ref) {
            document.getElementById("popup-overlay").style.display = "block";
            document.getElementById("popup").style.display = "block";
            button_href = "/admin"
            info_text = ""
            par = document.querySelector("#popup > div > p");
            button = document.querySelector("#popup > div > button");
            import_form = document.querySelector("#popup > div > form");
            par.style.display = "block"
            button.style.display = "inline-block"
            import_form.style.display = "none"
            // TODO: Write better info_texts
            switch (ref) {
                case "clear":
                    button_href += "?q=clear"
                    info_text = "This action will clear the cache.  Only do so if you believe the metadata shown is wrong."
                    break;
                case "import":
                    par.style.display = "none"
                    button.style.display = "none"
                    import_form.style.display = "block"
                    // TODO: code block to have a file upload
                    break;
                case "delete":
                    button_href += "?q=delete"
                    info_text = "This action will delete all your data.  There is no way to recover from this, your data will be gone."
                    break;
                default:
                // code block
            }
            if (par) {
                par.innerText = info_text;
            };
            if (button) {
                button.onclick = function () {
                    window.location.href = button_href;
                };
            }

        }
        function closePopup() {
            document.getElementById("popup-overlay").style.display = "none";
            document.getElementById("popup").style.display = "none";
        }

        document.addEventListener("DOMContentLoaded", function () {
            const form = document.querySelector("form");
            const reminder = document.getElementById("reminder");

            form.addEventListener("change", function () {
                reminder.style.display = "block";
            });
        });
    </script>
</body>