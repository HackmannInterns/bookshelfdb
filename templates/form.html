<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book Form</title>
    <style>
        /* CSS for center-aligning text */
        .form1 {
            margin: auto;
            text-align: center;
            padding: 100px 0;
        }

        .hidden {
            display: none;
        }


        .search {
            padding: 20px 0;
        }

        .label {
            padding-right: 5px;
            text-align: right;
            float: right;
        }

        .bar {
            padding-left: 5px;
            margin-left: auto;
        }

        @media only screen and (min-width: 40em) {
            .grid-overall {
                flex-direction: row;
                align-items: flex-start;
            }
        }

        @media only screen and (max-width: 40em) {
            .grid-overall {
                flex-direction: column;
                align-items: center;
            }

            .body {
                padding: 25px;
            }
        }

        .grid-overall {
            display: flex;
            margin: auto;
            padding: auto;
            justify-content: space-around;
        }


        .grid {
            display: grid;
            padding: inherit;
            grid-template-columns: auto auto;
            justify-content: center;
        }

        .grid-label {
            float: left;
            display: grid;
            grid-auto-columns: 1;
            grid-auto-rows: 5;
            grid-row-gap: 5px;
            text-align: right;
        }

        .grid-bar {
            float: right;
            display: grid;
            grid-auto-columns: 1;
            grid-auto-rows: 5;
        }

        .grid-locations-name {
            float: left;
            display: grid;
            grid-auto-columns: 1;
            grid-auto-rows: 3;
            grid-row-gap: 5px;
            text-align: right;

        }

        .grid-locations-bar {
            float: right;
            display: grid;
            grid-auto-columns: 1;
            grid-auto-rows: 3;

        }

        .grid-2 {
            display: grid;
            padding: inherit;
            grid-template-columns: auto auto;
            justify-content: center;
        }

        .submit_button {
            width: 90px;
            height: 40px;
            margin: auto;
            padding-top: 5px;
        }

        .empty_space {
            width: 16%;
        }

        .required {
            color: red;
            margin-left: 5px;
        }

        .body {
            overflow-y: auto;
        }

        .information {
            /* vertical-align: super; */
            font-size: small;
            color: #888;
        }
    </style>
</head>

{% include "header.html" %}

<body class="body">
    <div class="form1">
        <form method="post">
            <div class="grid-overall">
                <div class="empty_space">
                </div>
                <div class="empty_space">
                </div>
                <div class="grid">
                    <div class="grid-label">
                        <label class="label"><span class="required">*</span>Title</label>
                        <label class="label">Author(s)</label>
                        <label class="label" title="An identifier, such as the LCCN or ISBN">
                            <span class="information">&#9432;</span>
                            ID
                        </label>
                        <label class="label">Year</label>
                        <label class="label">Publisher(s)</label>
                        <label class="label" title="A list of Subjects or Genres covered by said book">
                            <span class="information">&#9432;
                            </span>
                            Subject(s)
                        </label>
                    </div>
                    <div class="grid-bar">
                        <input class="bar book_title" type="text" name="title" value="{{ title }}" required><br>
                        <input class="bar book_author" type="text" name="author" value="{{ author }}"><br>
                        <input class="bar book_id" type="text" name="book_id" value="{{ book_id }}"><br>
                        <input class="hidden book_id_type" type="text" name="id_type" value="{{ id_type }}">
                        <input class="hidden book_id_db" type="text" name="db_id" value="{{ db_id }}">
                        <input class="bar book_year" type="text" name="year" value="{{ year }}"><br>
                        <input class="bar book_publisher" type="text" name="publisher" value="{{ publisher }}"><br>
                        <input class="bar book_subjects" type="text" name="subjects" value="{{ subjects }}"><br>
                    </div>

                </div>
                <div class="grid-2">
                    <div class="grid-locations-name">
                        <label class="label">Address</label>
                        <label class="label">Room</label>
                        <label class="info"
                            title='An identifier that makes sense to you&#10;i.e. "3rd from the Right" or "Bookshelf #3"'>
                            <span class="information">&#9432; </span>
                            Bookshelf
                        </label>
                    </div>
                    <div class="grid-locations-bar">
                        <input class="bar address" type="text" name="address"
                            value="{{ session['address']|default(address) }}"><br>
                        <input class="bar room" type="text" name="room" value="{{ room|default(session['room']) }}"><br>
                        <input class="bar bookshelf" type="text" name="bookshelf"
                            value="{{ bookshelf|default(session['bookshelf']) }}"><br>
                    </div>
                </div>
                <div class="empty_space">
                </div>
            </div>
            <div onclick="clearID()" class="submit_button">
                <input type="submit" value="Submit">
                <input type="hidden" name="button_class" value="manual">
            </div>
        </form>
        <div class="submitting" style="display: none;">
            <p>Submitting... (3)</p>
            <button onclick="cancel_submit()">Cancel</button>
        </div>
        {% if edit is not defined or edit == False %}
        <div class="search">
            <form method="post">
                <select required name="id_type" id="id_type">
                    <option selected disabled value=""> -- Identifier Type -- </option>
                    <option value="isbn">ISBN</option>
                    <option value="lccn">Library of Congress</option>
                </select>
                <input class="bar search_id" type="text" name="search_id" value="{{ search_id }}" required><br><br>
                <div onclick="clearID()">
                    <input type="submit" name="action" value="Search via ID">
                    <input type="hidden" name="button_class" value="auto">
                </div>
            </form>
        </div>
        <div class="mass_search">
            <label class="label">Search via Title</label><br>
            <label class="label">Search via Author</label><br>
            <form method="post">
                <input class="bar search_title" type="text" name="search_title"><br>
                <input class="bar search_author" type="text" name="search_author"><br>
                <input type="submit" name="action" value="Search via Title or Author">
                <input type="hidden" name="button_class" value="title_author_search">
            </form>
        </div>
    </div>
    {% endif %}
    </div>
    <script>
        var cancel = false;
        window.onload = function () {
            var urlParams = new URLSearchParams(window.location.search);
            if (urlParams.has('edit')) {
                var searchDiv = document.querySelector('.search');
                searchDiv.style.display = 'none';
            }
        };

        function clearID() {
            history.pushState({}, document.title, window.location.pathname);
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        function cancel_submit() {
            cancel = true
            submit_div = document.querySelector("body > div > div.submitting")
            submit_div.style.display = "none"
        }

        async function countdown() {
            // console.log("yes")
            submit_p = document.querySelector("body > div > div.submitting > p")
            submit_div = document.querySelector("body > div > div.submitting")
            submit_div.style.display = "block"
            for (var i = 3; i > -1; i--) {
                // console.log(i);
                submit_p.innerText = `Submitting... (${i})`;
                await sleep(1 * 1000);
            }
            if (!cancel) {
                button = document.querySelector("body > div > form > div.submit_button > input[type=submit]:nth-child(1)");
                button.click()
            }
        }

        document.addEventListener('DOMContentLoaded', function () {
            // if autosubmit
            // if isbn and title
            // if it was autofilled (DO we need?)
            b_title = document.querySelector("body > div > form > div.grid-overall > div.grid > div.grid-bar > input.bar.book_title").value;
            b_id = document.querySelector("body > div > form > div.grid-overall > div.grid > div.grid-bar > input:nth-child(7)").value;
            if (('{{ session["autosubmit"] }}' == "True") && ('{{ session["autofilled"] }}' == "True") && b_title != "" && b_id != "") {
                countdown();
            }
        });

        function isMobileDevice() {
            return (typeof window.orientation !== "undefined") || (navigator.userAgent.indexOf('IEMobile') !== -1);
        }

        document.addEventListener("DOMContentLoaded", function () {
            if (isMobileDevice()) {
                var icons = document.querySelectorAll('.information');
                icons.forEach(function (icon) {
                    icon.addEventListener('click', function () {
                        var tooltipText = this.parentElement.getAttribute('title');
                        alert(tooltipText);
                    });
                });
            }
        });
    </script>
</body>

</html>